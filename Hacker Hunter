-- üåë DETECT HACKING v2.2 - AVATAR + COPY üî∞ [PART 1/3]
-- Services + Main Frame Setup
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local TweenService = game:GetService("TweenService")
local Debris = game:GetService("Debris")
local LocalPlayer = Players.LocalPlayer

-- Configuration
local SPEED_THRESHOLD = 35
local JUMP_HEIGHT_THRESHOLD = 80
local GROUND_DISTANCE_THRESHOLD = 15
local FLY_SECONDS_THRESHOLD = 8
local UPDATE_RATE = 0.15
local MIN_CONFIRMATION_TIME = 1.5

-- Create ScreenGui
local playerGui = LocalPlayer:WaitForChild("PlayerGui")
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "DetectHackingGUI"
screenGui.ResetOnSpawn = false
screenGui.Parent = playerGui

-- Main Frame
local mainFrame = Instance.new("Frame")
mainFrame.Name = "MainFrame"
mainFrame.Size = UDim2.fromOffset(420, 500)
mainFrame.Position = UDim2.new(0.02, 0, 0.12, 0)
mainFrame.BackgroundColor3 = Color3.fromRGB(15, 5, 5)
mainFrame.BorderSizePixel = 0
mainFrame.Parent = screenGui
mainFrame.Active = true
mainFrame.Draggable = true

local mainCorner = Instance.new("UICorner")
mainCorner.CornerRadius = UDim.new(0, 12)
mainCorner.Parent = mainFrame

local mainStroke = Instance.new("UIStroke")
mainStroke.Color = Color3.fromRGB(255, 0, 0)
mainStroke.Thickness = 3
mainStroke.Transparency = 0.3
mainStroke.Parent = mainFrame

local pulseTween = TweenService:Create(
    mainStroke,
    TweenInfo.new(2, Enum.EasingStyle.Sine, Enum.EasingDirection.InOut, -1, true),
    {Transparency = 0.7}
)
pulseTween:Play()

local gradient = Instance.new("UIGradient")
gradient.Color = ColorSequence.new{
    ColorSequenceKeypoint.new(0, Color3.fromRGB(25, 0, 0)),
    ColorSequenceKeypoint.new(1, Color3.fromRGB(10, 0, 0))
}
gradient.Rotation = 45
gradient.Parent = mainFrame

-- Title Bar
local titleBar = Instance.new("Frame")
titleBar.Name = "TitleBar"
titleBar.Size = UDim2.new(1, 0, 0, 50)
titleBar.Position = UDim2.new(0, 0, 0, 0)
titleBar.BackgroundColor3 = Color3.fromRGB(40, 0, 0)
titleBar.BorderSizePixel = 0
titleBar.Parent = mainFrame

local titleCorner = Instance.new("UICorner")
titleCorner.CornerRadius = UDim.new(0, 12)
titleCorner.Parent = titleBar

local titleStroke = Instance.new("UIStroke")
titleStroke.Color = Color3.fromRGB(255, 50, 50)
titleStroke.Thickness = 2
titleStroke.Parent = titleBar

local title = Instance.new("TextLabel")
title.Size = UDim2.new(1, -120, 1, 0)
title.Position = UDim2.new(0, 15, 0, 0)
title.BackgroundTransparency = 1
title.Text = "üî∞ HACK DETECTOR v2.2 - AVATAR SYSTEM üíÄ"
title.TextColor3 = Color3.fromRGB(255, 100, 100)
title.Font = Enum.Font.GothamBold
title.TextSize = 18
title.TextXAlignment = Enum.TextXAlignment.Left
title.Parent = titleBar

-- Toggle Button
local toggleBtn = Instance.new("TextButton")
toggleBtn.Size = UDim2.new(0, 90, 0, 35)
toggleBtn.Position = UDim2.new(1, -100, 0, 8)
toggleBtn.Text = "‡∏ã‡πà‡∏≠‡∏ô üîí"
toggleBtn.Font = Enum.Font.GothamBold
toggleBtn.TextSize = 14
toggleBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
toggleBtn.BackgroundColor3 = Color3.fromRGB(80, 0, 0)
toggleBtn.BorderSizePixel = 0
toggleBtn.Parent = titleBar

local toggleCorner = Instance.new("UICorner")
toggleCorner.CornerRadius = UDim.new(0, 8)
toggleCorner.Parent = toggleBtn

local toggleStroke = Instance.new("UIStroke")
toggleStroke.Color = Color3.fromRGB(255, 0, 0)
toggleStroke.Thickness = 2
toggleStroke.Parent = toggleBtn

-- List Container
local listFrame = Instance.new("Frame")
listFrame.Size = UDim2.new(1, -20, 1, -140)
listFrame.Position = UDim2.new(0, 10, 0, 60)
listFrame.BackgroundTransparency = 1
listFrame.Parent = mainFrame

local uiList = Instance.new("UIListLayout")
uiList.Parent = listFrame
uiList.SortOrder = Enum.SortOrder.LayoutOrder
uiList.Padding = UDim.new(0, 8)

local scrollbar = Instance.new("ScrollingFrame")
scrollbar.Size = UDim2.new(1, 0, 1, 0)
scrollbar.CanvasSize = UDim2.new(0, 0, 0, 0)
scrollbar.ScrollBarThickness = 6
scrollbar.ScrollBarImageColor3 = Color3.fromRGB(255, 0, 0)
scrollbar.BackgroundColor3 = Color3.fromRGB(25, 0, 0)
scrollbar.BorderSizePixel = 0
scrollbar.BackgroundTransparency = 0.8
scrollbar.Parent = listFrame

local scrollCorner = Instance.new("UICorner")
scrollCorner.CornerRadius = UDim.new(0, 8)
scrollCorner.Parent = scrollbar

-- Bottom Area
local bottom = Instance.new("Frame")
bottom.Size = UDim2.new(1, -20, 0, 65)
bottom.Position = UDim2.new(0, 10, 1, -85)
bottom.BackgroundColor3 = Color3.fromRGB(30, 0, 0)
bottom.BorderSizePixel = 0
bottom.Parent = mainFrame

local bottomCorner = Instance.new("UICorner")
bottomCorner.CornerRadius = UDim.new(0, 8)
bottomCorner.Parent = bottom

local bottomStroke = Instance.new("UIStroke")
bottomStroke.Color = Color3.fromRGB(200, 0, 0)
bottomStroke.Thickness = 2
bottomStroke.Parent = bottom

-- Info Label
local infoLabel = Instance.new("TextLabel")
infoLabel.Size = UDim2.new(1, -150, 1, 0)
infoLabel.Position = UDim2.new(0, 10, 0, 0)
infoLabel.BackgroundTransparency = 1
infoLabel.Text = "No confirmed hackers detected üîç"
infoLabel.TextColor3 = Color3.fromRGB(200, 200, 200)
infoLabel.Font = Enum.Font.Gotham
infoLabel.TextSize = 14
infoLabel.TextXAlignment = Enum.TextXAlignment.Left
infoLabel.TextYAlignment = Enum.TextYAlignment.Center
infoLabel.TextWrapped = true
infoLabel.Parent = bottom

-- Look Button
local lookBtn = Instance.new("TextButton")
lookBtn.Size = UDim2.new(0, 70, 0, 40)
lookBtn.Position = UDim2.new(1, -150, 0, 12)
lookBtn.Text = "LOOK üëÅÔ∏è"
lookBtn.Font = Enum.Font.GothamBold
lookBtn.TextSize = 12
lookBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
lookBtn.BackgroundColor3 = Color3.fromRGB(100, 0, 0)
lookBtn.BorderSizePixel = 0
lookBtn.Parent = bottom

local lookCorner = Instance.new("UICorner")
lookCorner.CornerRadius = UDim.new(0, 8)
lookCorner.Parent = lookBtn

local lookStroke = Instance.new("UIStroke")
lookStroke.Color = Color3.fromRGB(255, 100, 100)
lookStroke.Thickness = 2
lookStroke.Parent = lookBtn

-- Copy All Button
local copyAllBtn = Instance.new("TextButton")
copyAllBtn.Size = UDim2.new(0, 70, 0, 40)
copyAllBtn.Position = UDim2.new(1, -75, 0, 12)
copyAllBtn.Text = "COPY üìã"
copyAllBtn.Font = Enum.Font.GothamBold
copyAllBtn.TextSize = 12
copyAllBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
copyAllBtn.BackgroundColor3 = Color3.fromRGB(0, 100, 0)
copyAllBtn.BorderSizePixel = 0
copyAllBtn.Parent = bottom

local copyCorner = Instance.new("UICorner")
copyCorner.CornerRadius = UDim.new(0, 8)
copyCorner.Parent = copyAllBtn

local copyStroke = Instance.new("UIStroke")
copyStroke.Color = Color3.fromRGB(0, 255, 0)
copyStroke.Thickness = 2
copyStroke.Parent = copyAllBtn

-- State Variables
local suspicious = {}
local selectedPlayer = nil
local cameraFollowing = false
local originalCameraSubject = workspace.CurrentCamera and workspace.CurrentCamera.CameraSubject
local miniToggle = nil

-- [‡∏à‡∏ö‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 1/3 - ‡∏£‡∏≠‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 2]
print("üìú PART 1/3 - GUI Setup ‡πÇ‡∏´‡∏•‡∏î‡πÅ‡∏•‡πâ‡∏ß! ‡∏£‡∏≠ PART 2...")
-- üåë DETECT HACKING v2.2 - AVATAR + COPY üî∞ [PART 2/3]
-- Functions + Avatar System

-- Copy Function
local function copyToClipboard(text)
    if setclipboard then
        setclipboard(text)
        return true
    else
        warn("‚ùå ‡πÑ‡∏°‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö Copy Function! ‡πÉ‡∏ä‡πâ Exploiter ‡∏ó‡∏µ‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö setclipboard")
        return false
    end
end

-- Particle Effect
local function createWarningEffect(frame)
    local particles = Instance.new("Frame")
    particles.Size = UDim2.new(1, 20, 1, 20)
    particles.Position = UDim2.new(0, -10, 0, -10)
    particles.BackgroundTransparency = 1
    particles.Parent = frame
    
    local particle1 = Instance.new("Frame")
    particle1.Size = UDim2.new(0, 4, 0, 4)
    particle1.Position = UDim2.new(0, 0, 0.5, 0)
    particle1.BackgroundColor3 = Color3.fromRGB(255, 50, 50)
    particle1.BorderSizePixel = 0
    particle1.Parent = particles
    
    local particle2 = Instance.new("Frame")
    particle2.Size = UDim2.new(0, 4, 0, 4)
    particle2.Position = UDim2.new(1, -4, 0.5, 0)
    particle2.BackgroundColor3 = Color3.fromRGB(255, 100, 0)
    particle2.BorderSizePixel = 0
    particle2.Parent = particles
    
    spawn(function()
        while particles.Parent do
            TweenService:Create(particle1, TweenInfo.new(0.5, Enum.EasingStyle.Quad, Enum.EasingDirection.InOut), {
                Position = UDim2.new(math.random(), 0, math.random(), 0),
                BackgroundTransparency = math.random(0.3, 0.7)
            }):Play()
            TweenService:Create(particle2, TweenInfo.new(0.7, Enum.EasingStyle.Sine, Enum.EasingDirection.InOut), {
                Position = UDim2.new(math.random(), 0, math.random(), 0),
                BackgroundTransparency = math.random(0.4, 0.8)
            }):Play()
            wait(0.3)
        end
    end)
end

-- Load Player Avatar
local function loadPlayerAvatar(plr, parentFrame)
    local avatarFrame = Instance.new("Frame")
    avatarFrame.Size = UDim2.new(0, 50, 0, 50)
    avatarFrame.Position = UDim2.new(0, 5, 0.1, 0)
    avatarFrame.BackgroundColor3 = Color3.fromRGB(50, 0, 0)
    avatarFrame.BorderSizePixel = 0
    avatarFrame.Parent = parentFrame

    local avatarCorner = Instance.new("UICorner")
    avatarCorner.CornerRadius = UDim.new(0, 25)
    avatarCorner.Parent = avatarFrame

    local avatarStroke = Instance.new("UIStroke")
    avatarStroke.Color = Color3.fromRGB(255, 0, 0)
    avatarStroke.Thickness = 2
    avatarStroke.Transparency = 0.5
    avatarStroke.Parent = avatarFrame

    local avatarImage = Instance.new("ImageLabel")
    avatarImage.Size = UDim2.new(1, -4, 1, -4)
    avatarImage.Position = UDim2.new(0, 2, 0, 2)
    avatarImage.BackgroundTransparency = 1
    avatarImage.Image = "rbxthumb://type=AvatarHeadShot&id=" .. plr.UserId .. "&w=150&h=150"
    avatarImage.Parent = avatarFrame

    local imageCorner = Instance.new("UICorner")
    imageCorner.CornerRadius = UDim.new(0, 23)
    imageCorner.Parent = avatarImage

    local glowTween = TweenService:Create(
        avatarStroke,
        TweenInfo.new(1, Enum.EasingStyle.Sine, Enum.EasingDirection.InOut, -1, true),
        {Transparency = 0.2}
    )
    glowTween:Play()

    avatarFrame.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseMovement then
            TweenService:Create(avatarStroke, TweenInfo.new(0.2), {
                Thickness = 3,
                Color = Color3.fromRGB(255, 255, 0)
            }):Play()
        end
    end)

    avatarFrame.InputEnded:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseMovement then
            TweenService:Create(avatarStroke, TweenInfo.new(0.2), {
                Thickness = 2,
                Color = Color3.fromRGB(255, 0, 0),
                Transparency = 0.5
            }):Play()
        end
    end)

    return avatarFrame
end

-- Create Entry Function
local function createEntry(plr)
    local f = Instance.new("Frame")
    f.Size = UDim2.new(1, -10, 0, 80)
    f.BackgroundColor3 = Color3.fromRGB(25, 5, 5)
    f.BorderSizePixel = 0
    f.Parent = scrollbar

    local fCorner = Instance.new("UICorner")
    fCorner.CornerRadius = UDim.new(0, 8)
    fCorner.Parent = f

    local fStroke = Instance.new("UIStroke")
    fStroke.Color = Color3.fromRGB(100, 0, 0)
    fStroke.Thickness = 1
    fStroke.Parent = f

    local avatarFrame = loadPlayerAvatar(plr, f)

    local nameLabel = Instance.new("TextLabel")
    nameLabel.Size = UDim2.new(0.45, -15, 0.4, 0)
    nameLabel.Position = UDim2.new(0, 65, 0, 5)
    nameLabel.BackgroundTransparency = 1
    nameLabel.Font = Enum.Font.GothamBold
    nameLabel.TextSize = 16
    nameLabel.TextColor3 = Color3.fromRGB(255, 150, 150)
    nameLabel.TextXAlignment = Enum.TextXAlignment.Left
    nameLabel.TextWrapped = true
    nameLabel.Parent = f

    local tagLabel = Instance.new("TextLabel")
    tagLabel.Size = UDim2.new(0.35, -15, 0.4, 0)
    tagLabel.Position = UDim2.new(0, 65, 0, 25)
    tagLabel.BackgroundTransparency = 1
    tagLabel.Font = Enum.Font.GothamBold
    tagLabel.TextSize = 12
    tagLabel.TextColor3 = Color3.fromRGB(255, 255, 100)
    tagLabel.TextXAlignment = Enum.TextXAlignment.Right
    tagLabel.Parent = f

    local reasons = Instance.new("TextLabel")
    reasons.Size = UDim2.new(0.75, -20, 0.6, 0)
    reasons.Position = UDim2.new(0, 65, 0.4, 0)
    reasons.BackgroundTransparency = 1
    reasons.Font = Enum.Font.Gotham
    reasons.TextSize = 11
    reasons.TextColor3 = Color3.fromRGB(255, 100, 100)
    reasons.TextXAlignment = Enum.TextXAlignment.Left
    reasons.TextYAlignment = Enum.TextYAlignment.Top
    reasons.TextWrapped = true
    reasons.Parent = f

    local selectBtn = Instance.new("TextButton")
    selectBtn.Size = UDim2.new(0, 45, 0, 25)
    selectBtn.Position = UDim2.new(1, -95, 0.1, 0)
    selectBtn.Text = "SEL ‚ö°"
    selectBtn.Font = Enum.Font.GothamBold
    selectBtn.TextSize = 10
    selectBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
    selectBtn.BackgroundColor3 = Color3.fromRGB(80, 0, 0)
    selectBtn.BorderSizePixel = 0
    selectBtn.Parent = f

    local selectCorner = Instance.new("UICorner")
    selectCorner.CornerRadius = UDim.new(0, 5)
    selectCorner.Parent = selectBtn

    local copyBtn = Instance.new("TextButton")
    copyBtn.Size = UDim2.new(0, 45, 0, 25)
    copyBtn.Position = UDim2.new(1, -95, 0.45, 0)
    copyBtn.Text = "COPY üìã"
    copyBtn.Font = Enum.Font.GothamBold
    copyBtn.TextSize = 10
    copyBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
    copyBtn.BackgroundColor3 = Color3.fromRGB(0, 80, 0)
    copyBtn.BorderSizePixel = 0
    copyBtn.Parent = f

    local copyEntryCorner = Instance.new("UICorner")
    copyEntryCorner.CornerRadius = UDim.new(0, 5)
    copyEntryCorner.Parent = copyBtn

    local copyEntryStroke = Instance.new("UIStroke")
    copyEntryStroke.Color = Color3.fromRGB(0, 255, 0)
    copyEntryStroke.Thickness = 1.5
    copyEntryStroke.Parent = copyBtn

    copyBtn.MouseButton1Click:Connect(function()
        local success = copyToClipboard(plr.Name)
        if success then
            TweenService:Create(copyBtn, TweenInfo.new(0.2), {
                BackgroundColor3 = Color3.fromRGB(0, 150, 0)
            }):Play()
            copyBtn.Text = "COPIED! ‚úÖ"
            wait(1)
            TweenService:Create(copyBtn, TweenInfo.new(0.2), {
                BackgroundColor3 = Color3.fromRGB(0, 80, 0)
            }):Play()
            copyBtn.Text = "COPY üìã"
            
            local flash = Instance.new("Frame")
            flash.Size = UDim2.new(1, 0, 1, 0)
            flash.Position = UDim2.new(0, 0, 0, 0)
            flash.BackgroundColor3 = Color3.fromRGB(0, 255, 0)
            flash.BackgroundTransparency = 1
            flash.Parent = screenGui
            
            TweenService:Create(flash, TweenInfo.new(0.1), {BackgroundTransparency = 0.8}):Play()
            TweenService:Create(flash, TweenInfo.new(0.2), {BackgroundTransparency = 1}):Play()
            Debris:AddItem(flash, 0.3)
        else
            TweenService:Create(copyBtn, TweenInfo.new(0.2), {
                BackgroundColor3 = Color3.fromRGB(100, 0, 0)
            }):Play()
            copyBtn.Text = "ERROR ‚ùå"
            wait(1)
            TweenService:Create(copyBtn, TweenInfo.new(0.2), {
                BackgroundColor3 = Color3.fromRGB(0, 80, 0)
            }):Play()
            copyBtn.Text = "COPY üìã"
        end
    end)

    selectBtn.MouseButton1Click:Connect(function()
        selectedPlayer = plr
        infoLabel.Text = ("üî• Selected: %s (HACKER CONFIRMED!) üë§%s"):format(plr.Name, plr.UserId)
        
        for _, v in pairs(scrollbar:GetChildren()) do
            if v:IsA("Frame") then
                TweenService:Create(v, TweenInfo.new(0.3), {BackgroundColor3 = Color3.fromRGB(25, 5, 5)}):Play()
                if v:FindFirstChild("UIStroke") then
                    v:FindFirstChild("UIStroke").Color = Color3.fromRGB(100, 0, 0)
                end
            end
        end
        
        TweenService:Create(f, TweenInfo.new(0.3), {BackgroundColor3 = Color3.fromRGB(60, 0, 0)}):Play()
        fStroke.Color = Color3.fromRGB(255, 255, 0)
    end)

    createWarningEffect(f)

    return {
        frame = f,
        nameLabel = nameLabel,
        tagLabel = tagLabel,
        reasonsLabel = reasons,
        selectBtn = selectBtn,
        copyBtn = copyBtn,
        avatarFrame = avatarFrame
    }
end

-- Helper Functions
local function refreshCanvas()
    local total = 0
    for _, v in pairs(scrollbar:GetChildren()) do
        if v:IsA("Frame") then
            total = total + v.AbsoluteSize.Y + uiList.Padding.Offset
        end
    end
    scrollbar.CanvasSize = UDim2.new(0, 0, 0, math.max(total, 200))
end

local function removeEntry(plr)
    if suspicious[plr] and suspicious[plr].gui then
        TweenService:Create(suspicious[plr].gui.frame, TweenInfo.new(0.5), {
            BackgroundTransparency = 1,
            Size = UDim2.new(1, 0, 0, 0)
        }):Play()
        Debris:AddItem(suspicious[plr].gui.frame, 0.5)
    end
    suspicious[plr] = nil
    if selectedPlayer == plr then
        selectedPlayer = nil
        infoLabel.Text = "No confirmed hackers üîç"
    end
    refreshCanvas()
end

-- [‡∏à‡∏ö‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 2/3 - ‡∏£‡∏≠‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 3]
print("üìú PART 2/3 - Functions + Avatar ‡πÇ‡∏´‡∏•‡∏î‡πÅ‡∏•‡πâ‡∏ß! ‡∏£‡∏≠ PART 3...")
-- üåë DETECT HACKING v2.2 - AVATAR + COPY üî∞ [PART 3/3]
-- Detection Logic + UI Events

-- Detection State
local state = {}
local confirmationTimers = {}

-- Ground Detection
local function distanceToGround(rootPart)
    local origin = rootPart.Position
    local params = RaycastParams.new()
    params.FilterDescendantsInstances = {rootPart.Parent}
    params.FilterType = Enum.RaycastFilterType.Blacklist
    local result = workspace:Raycast(origin, Vector3.new(0, -200, 0), params)
    if result and result.Position then
        local distance = (origin - result.Position).Magnitude
        local hitPart = result.Instance
        if hitPart and (hitPart.Name:lower():find("tree") or hitPart.Name:lower():find("wood") or 
                        hitPart.Size.Y < 5) then
            return 0
        end
        return distance
    else
        return math.huge
    end
end

local function setSuspicion(plr, reason)
    local currentTime = tick()
    
    if not confirmationTimers[plr] then
        confirmationTimers[plr] = currentTime
    end
    
    local suspicionTime = currentTime - confirmationTimers[plr]
    
    if suspicionTime < MIN_CONFIRMATION_TIME then
        return false
    end
    
    local rec = suspicious[plr]
    if not rec then
        rec = {
            reasons = {},
            gui = createEntry(plr),
            timers = { groundStart = nil, inAir = false, jumpStartY = nil, maxY = nil },
            confirmed = true
        }
        suspicious[plr] = rec
    end
    rec.reasons[reason] = true

    local displayName = plr.DisplayName or plr.Name
    rec.gui.nameLabel.Text = "üíÄ " .. displayName .. "\n(ID: " .. plr.UserId .. ")"
    
    local reasonText = {}
    for k, _ in pairs(rec.reasons) do
        table.insert(reasonText, k)
    end
    rec.gui.reasonsLabel.Text = "‚ö†Ô∏è  " .. table.concat(reasonText, " | ")
    rec.gui.tagLabel.Text = (#reasonText > 0) and ("üö® CONFIRMED: " .. #reasonText) or ""
    
    local f = rec.gui.frame
    TweenService:Create(f, TweenInfo.new(0.2), {BackgroundColor3 = Color3.fromRGB(80, 0, 0)}):Play()
    wait(0.2)
    TweenService:Create(f, TweenInfo.new(0.2), {BackgroundColor3 = Color3.fromRGB(25, 5, 5)}):Play()
    
    refreshCanvas()
    return true
end

local function clearReason(plr, reason)
    local rec = suspicious[plr]
    if not rec then return end
    rec.reasons[reason] = nil
    
    local any = false
    for k, _ in pairs(rec.reasons) do 
        any = true 
        break 
    end
    
    if not any then
        spawn(function()
            wait(3)
            if not suspicious[plr] or not next(suspicious[plr].reasons) then
                removeEntry(plr)
            end
        end)
    else
        local reasonText = {}
        for k, _ in pairs(rec.reasons) do 
            table.insert(reasonText, k) 
        end
        rec.gui.reasonsLabel.Text = "‚ö†Ô∏è  " .. table.concat(reasonText, " | ")
        rec.gui.tagLabel.Text = ("üö® CONFIRMED: %d"):format(#reasonText)
    end
end

-- Main Detection Loop
spawn(function()
    while true do
        local players = Players:GetPlayers()
        local confirmedHackers = 0
        
        for _, plr in pairs(players) do
            if plr ~= LocalPlayer and plr.Character and plr.Character.Parent then
                local hrp = plr.Character:FindFirstChild("HumanoidRootPart")
                local humanoid = plr.Character:FindFirstChildWhichIsA("Humanoid")
                if hrp and humanoid then
                    if not state[plr] then
                        state[plr] = { 
                            onGround = true, 
                            startY = hrp.Position.Y, 
                            maxY = hrp.Position.Y, 
                            airStartTime = nil, 
                            groundDistanceTimer = 0,
                            speedViolations = 0,
                            jumpViolations = 0
                        }
                    end
                    local st = state[plr]

                    local vel = hrp.Velocity
                    local horizSpeed = Vector3.new(vel.X, 0, vel.Z).Magnitude
                    if horizSpeed > SPEED_THRESHOLD then
                        st.speedViolations = (st.speedViolations or 0) + 1
                        if st.speedViolations >= 3 then
                            setSuspicion(plr, "üöÄ SPEED HACK: " .. math.floor(horizSpeed) .. " studs/s")
                        end
                    else
                        st.speedViolations = 0
                        clearReason(plr, "üöÄ SPEED HACK: " .. math.floor(horizSpeed) .. " studs/s")
                    end

                    local dist = distanceToGround(hrp)
                    if dist > GROUND_DISTANCE_THRESHOLD and dist < 100 then
                        st.groundDistanceTimer = (st.groundDistanceTimer or 0) + UPDATE_RATE
                        if st.groundDistanceTimer >= FLY_SECONDS_THRESHOLD then
                            setSuspicion(plr, "üõ∏ FLY HACK: " .. math.floor(dist) .. " studs")
                        end
                    else
                        st.groundDistanceTimer = 0
                        clearReason(plr, "üõ∏ FLY HACK: " .. math.floor(dist) .. " studs")
                    end

                    if humanoid.FloorMaterial == Enum.Material.Air then
                        if not st.inAir then
                            st.inAir = true
                            st.jumpStartY = hrp.Position.Y
                            st.maxY = hrp.Position.Y
                            st.airStartTime = tick()
                        else
                            if hrp.Position.Y > st.maxY then 
                                st.maxY = hrp.Position.Y 
                            end
                        end
                    else
                        if st.inAir then
                            local jumpHeight = st.maxY - (st.jumpStartY or st.maxY)
                            if jumpHeight >= JUMP_HEIGHT_THRESHOLD then
                                st.jumpViolations = (st.jumpViolations or 0) + 1
                                if st.jumpViolations >= 2 then
                                    setSuspicion(plr, "ü¶ò JUMP HACK: " .. math.floor(jumpHeight) .. " studs")
                                end
                            else
                                st.jumpViolations = 0
                                clearReason(plr, "ü¶ò JUMP HACK: " .. math.floor(jumpHeight) .. " studs")
                            end
                        end
                        st.inAir = false
                        st.jumpStartY = nil
                        st.maxY = nil
                        st.airStartTime = nil
                    end

                    if suspicious[plr] then
                        confirmedHackers = confirmedHackers + 1
                    end
                else
                    if state[plr] then
                        state[plr] = nil
                    end
                    removeEntry(plr)
                end
            else
                if state[plr] then
                    state[plr] = nil
                end
                removeEntry(plr)
            end
        end

        if confirmedHackers == 0 then
            TweenService:Create(infoLabel, TweenInfo.new(0.5), {TextColor3 = Color3.fromRGB(150, 150, 150)}):Play()
            infoLabel.Text = "No confirmed hackers detected üîç\n(Waiting for confirmation...)"
        else
            TweenService:Create(infoLabel, TweenInfo.new(0.3), {TextColor3 = Color3.fromRGB(255, 100, 100)}):Play()
            infoLabel.Text = ("üî• CONFIRMED HACKERS: %d players! üíÄ\nüë§ Click COPY to get names!"):format(confirmedHackers)
        end

        for plr, _ in pairs(suspicious) do
            if not table.find(Players:GetPlayers(), plr) then
                removeEntry(plr)
            end
        end

        wait(UPDATE_RATE)
    end
end)

-- Copy All Button Logic
local hackerNames = ""
copyAllBtn.MouseButton1Click:Connect(function()
    hackerNames = ""
    local count = 0
    
    for plr, _ in pairs(suspicious) do
        if plr and plr.Name then
            hackerNames = hackerNames .. plr.Name .. " (" .. plr.UserId .. ")\n"
            count = count + 1
        end
    end
    
    if count == 0 then
        infoLabel.Text = "‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÅ‡∏Æ‡∏Å‡πÄ‡∏Å‡∏≠‡∏£‡πå‡πÉ‡∏´‡πâ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å! üòà"
        return
    end
    
    local success = copyToClipboard(hackerNames)
    if success then
        TweenService:Create(copyAllBtn, TweenInfo.new(0.2), {
            BackgroundColor3 = Color3.fromRGB(0, 150, 0)
        }):Play()
        copyAllBtn.Text = "COPIED! ‚úÖ"
        infoLabel.Text = ("üìã Copied %d hacker names!\n(Click individual COPY for single names)"):format(count)
        
        wait(1.5)
        TweenService:Create(copyAllBtn, TweenInfo.new(0.2), {
            BackgroundColor3 = Color3.fromRGB(0, 100, 0)
        }):Play()
        copyAllBtn.Text = "COPY üìã"
    else
        TweenService:Create(copyAllBtn, TweenInfo.new(0.2), {
            BackgroundColor3 = Color3.fromRGB(100, 0, 0)
        }):Play()
        copyAllBtn.Text = "ERROR ‚ùå"
        infoLabel.Text = "‚ùå Copy failed! Check your exploit."
        wait(1.5)
        TweenService:Create(copyAllBtn, TweenInfo.new(0.2), {
            BackgroundColor3 = Color3.fromRGB(0, 100, 0)
        }):Play()
        copyAllBtn.Text = "COPY üìã"
    end
end)

-- Camera Follow
local camera = workspace.CurrentCamera
local previousCameraSubject = camera.CameraSubject

local function stopFollowing()
    camera.CameraSubject = previousCameraSubject or workspace.CurrentCamera.CameraSubject
    camera.CameraType = Enum.CameraType.Custom
    cameraFollowing = false
    lookBtn.Text = "LOOK üëÅÔ∏è"
    TweenService:Create(lookBtn, TweenInfo.new(0.3), {BackgroundColor3 = Color3.fromRGB(100, 0, 0)}):Play()
end

local function startFollowing(plr)
    if not plr or not plr.Character then return end
    local hum = plr.Character:FindFirstChildWhichIsA("Humanoid")
    if not hum then return end
    
    previousCameraSubject = camera.CameraSubject
    camera.CameraSubject = hum
    camera.CameraType = Enum.CameraType.Follow
    cameraFollowing = true
    lookBtn.Text = "STOP ‚ùå"
    TweenService:Create(lookBtn, TweenInfo.new(0.3), {BackgroundColor3 = Color3.fromRGB(150, 0, 0)}):Play()
end

lookBtn.MouseButton1Click:Connect(function()
    if cameraFollowing then
        stopFollowing()
        return
    end
    
    if selectedPlayer and selectedPlayer.Character and selectedPlayer.Character.Parent then
        startFollowing(selectedPlayer)
    else
        for plr, rec in pairs(suspicious) do
            selectedPlayer = plr
            startFollowing(plr)
            infoLabel.Text = ("üî• Tracking: %s (UserID: %s)"):format(plr.Name, plr.UserId)
            break
        end
        if not cameraFollowing then
            infoLabel.Text = "No confirmed hackers to track! üòà"
        end
    end
end)

-- Mini Toggle System
local function createMiniToggle()
    if miniToggle then return end
    
    miniToggle = Instance.new("TextButton")
    miniToggle.Name = "MiniDetectToggle"
    miniToggle.Size = UDim2.new(0, 70, 0, 30)
    miniToggle.Position = UDim2.new(0, 10, 0, 10)
    miniToggle.Text = "‡πÅ‡∏™‡∏î‡∏á üëÅÔ∏è"
    miniToggle.Font = Enum.Font.GothamBold
    miniToggle.TextSize = 12
    miniToggle.TextColor3 = Color3.fromRGB(255, 255, 255)
    miniToggle.BackgroundColor3 = Color3.fromRGB(50, 0, 0)
    miniToggle.BorderSizePixel = 0
    miniToggle.Parent = screenGui
    miniToggle.Active = true
    miniToggle.Draggable = true

    local miniCorner = Instance.new("UICorner")
    miniCorner.CornerRadius = UDim.new(0, 8)
    miniCorner.Parent = miniToggle

    local miniStroke = Instance.new("UIStroke")
    miniStroke.Color = Color3.fromRGB(255, 0, 0)
    miniStroke.Thickness = 2
    miniStroke.Parent = miniToggle

    miniToggle.MouseEnter:Connect(function()
        TweenService:Create(miniToggle, TweenInfo.new(0.2), {
            BackgroundColor3 = Color3.fromRGB(80, 0, 0),
            Size = UDim2.new(0, 75, 0, 32)
        }):Play()
        TweenService:Create(miniStroke, TweenInfo.new(0.2), {Thickness = 3}):Play()
    end)

    miniToggle.MouseLeave:Connect(function()
        TweenService:Create(miniToggle, TweenInfo.new(0.2), {
            BackgroundColor3 = Color3.fromRGB(50, 0, 0),
            Size = UDim2.new(0, 70, 0, 30)
        }):Play()
        TweenService:Create(miniStroke, TweenInfo.new(0.2), {Thickness = 2}):Play()
    end)

    miniToggle.MouseButton1Click:Connect(function()
        mainFrame.Visible = true
        toggleBtn.Text = "‡∏ã‡πà‡∏≠‡∏ô üîí"
        miniToggle:Destroy()
        miniToggle = nil
    end)

    spawn(function()
        while miniToggle and miniToggle.Parent do
            TweenService:Create(miniStroke, TweenInfo.new(1.5, Enum.EasingStyle.Sine, Enum.EasingDirection.InOut), {
                Transparency = 0.2
            }):Play()
            wait(1.5)
            TweenService:Create(miniStroke, TweenInfo.new(1.5, Enum.EasingStyle.Sine, Enum.EasingDirection.InOut), {
                Transparency = 0.5
            }):Play()
            wait(1.5)
        end
    end)
end

-- Toggle Logic
local hidden = false
toggleBtn.MouseButton1Click:Connect(function()
    hidden = not hidden
    mainFrame.Visible = not hidden
    toggleBtn.Text = hidden and "‡πÅ‡∏™‡∏î‡∏á üëÅÔ∏è" or "‡∏ã‡πà‡∏≠‡∏ô üîí"
    
    if hidden then
        createMiniToggle()
    else
        if miniToggle then
            miniToggle:Destroy()
            miniToggle = nil
        end
    end
end)

toggleBtn.MouseEnter:Connect(function()
    TweenService:Create(toggleBtn, TweenInfo.new(0.2), {
        BackgroundColor3 = Color3.fromRGB(120, 0, 0),
        Size = UDim2.new(0, 95, 0, 38)
    }):Play()
end)

toggleBtn.MouseLeave:Connect(function()
    TweenService:Create(toggleBtn, TweenInfo.new(0.2), {
        BackgroundColor3 = Color3.fromRGB(80, 0, 0),
        Size = UDim2.new(0, 90, 0, 35)
    }):Play()
end)

-- Look Button Effects
lookBtn.MouseEnter:Connect(function()
    TweenService:Create(lookBtn, TweenInfo.new(0.2), {
        BackgroundColor3 = Color3.fromRGB(150, 0, 0),
        Size = UDim2.new(0, 75, 0, 42)
    }):Play()
end)

lookBtn.MouseLeave:Connect(function()
    TweenService:Create(lookBtn, TweenInfo.new(0.2), {
        BackgroundColor3 = Color3.fromRGB(100, 0, 0),
        Size = UDim2.new(0, 70, 0, 40)
    }):Play()
end)

-- Copy All Button Effects
copyAllBtn.MouseEnter:Connect(function()
    TweenService:Create(copyAllBtn, TweenInfo.new(0.2), {
        BackgroundColor3 = Color3.fromRGB(0, 150, 0),
        Size = UDim2.new(0, 75, 0, 42)
    }):Play()
end)

copyAllBtn.MouseLeave:Connect(function()
    TweenService:Create(copyAllBtn, TweenInfo.new(0.2), {
        BackgroundColor3 = Color3.fromRGB(0, 100, 0),
        Size = UDim2.new(0, 70, 0, 40)
    }):Play()
end)

-- Cleanup
Players.PlayerRemoving:Connect(function(plr)
    if state[plr] then
        state[plr] = nil
    end
    removeEntry(plr)
end)

-- Initial Setup
refreshCanvas()
wait(1)
print("üåë HACK DETECTOR v2.2 ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏•‡πà‡∏≤‡πÅ‡∏•‡πâ‡∏ß!")
print("üìú PART 3/3 ‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏™‡∏£‡πá‡∏à! GUI ‡∏™‡∏∏‡∏î‡πÄ‡∏ó‡πà‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô!")
print("üë§ Avatar System: ‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏π‡∏õ Hacker!")
print("üìã Copy System: ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠ 1 ‡∏Ñ‡∏•‡∏¥‡∏Å!")
print("üéÆ Mini Toggle: ‡∏õ‡∏∏‡πà‡∏°‡∏•‡∏≠‡∏¢‡∏•‡∏≤‡∏Å‡πÑ‡∏î‡πâ!")
