local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local ReplicatedStorage = game:GetService("ReplicatedStorage")

local LocalPlayer = Players.LocalPlayer
local Character = LocalPlayer.Character or LocalPlayer.CharacterAdded:Wait()
local Humanoid = Character:WaitForChild("Humanoid")

-- Accessory IDs
local walkAccessoryId = 18658405017
local jumpAccessoryId = 13935777037
local lowHealthAccessoryId = 5861465755
local faceAccessoryId = 107376129222501

-- à¸ªà¸–à¸²à¸™à¸°
local isWalking = false
local isJumping = false
local isLowHealth = false

local CatalogRemote = ReplicatedStorage:WaitForChild("BloxbizRemotes")
	:WaitForChild("CatalogOnApplyToRealHumanoid")

-- à¸Ÿà¸±à¸‡à¸à¹Œà¸Šà¸±à¸™à¹ƒà¸ªà¹ˆ/à¸–à¸­à¸” Accessory
local function wearAccessory(assetId, accessoryType)
	local args
	if accessoryType then
		args = {
			{
				AccessoryData = {
					Order = 1,
					AccessoryType = accessoryType,
					AssetId = assetId
				}
			}
		}
	else
		args = {
			{
				AssetId = assetId
			}
		}
	end
	CatalogRemote:FireServer(unpack(args))
end

local function removeAccessory(assetId)
	local args = {
		{
			AssetId = assetId
		}
	}
	CatalogRemote:FireServer(unpack(args))
end

-- à¸•à¸£à¸§à¸ˆà¸ˆà¸±à¸šà¸à¸²à¸£à¹€à¸”à¸´à¸™
RunService.RenderStepped:Connect(function()
	if Humanoid.MoveDirection.Magnitude > 0 then
		if not isWalking and not isJumping then
			isWalking = true
			wearAccessory(walkAccessoryId, Enum.AccessoryType.Back)
		end
	elseif isWalking and not isJumping then
		isWalking = false
		removeAccessory(walkAccessoryId)
	end
end)

-- à¸•à¸£à¸§à¸ˆà¸ˆà¸±à¸šà¸à¸²à¸£à¸à¸£à¸°à¹‚à¸”à¸”à¹à¸¥à¸°à¸¥à¸‡à¸žà¸·à¹‰à¸™
Humanoid.StateChanged:Connect(function(_, newState)
	if newState == Enum.HumanoidStateType.Jumping then
		if not isJumping then
			isJumping = true
			if isWalking then
				removeAccessory(walkAccessoryId)
			end
			wearAccessory(jumpAccessoryId, Enum.AccessoryType.Back)
		end
	elseif newState == Enum.HumanoidStateType.Landed then
		if isJumping then
			isJumping = false
			removeAccessory(jumpAccessoryId)
			if Humanoid.MoveDirection.Magnitude > 0 then
				isWalking = true
				wearAccessory(walkAccessoryId, Enum.AccessoryType.Back)
			end
		end
	end
end)

-- à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸š HP (Low Health à¹ƒà¸ªà¹ˆà¸—à¸±à¸šà¹„à¸”à¹‰)
Humanoid.HealthChanged:Connect(function(health)
	if health < Humanoid.MaxHealth then
		if not isLowHealth then
			isLowHealth = true
			wearAccessory(lowHealthAccessoryId, Enum.AccessoryType.Back)
		end
	else
		if isLowHealth then
			isLowHealth = false
			removeAccessory(lowHealthAccessoryId)
		end
	end
end)

-- à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸šà¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡à¹à¸Šà¸— à¹ƒà¸ªà¹ˆ Face 3 à¸§à¸´à¸™à¸²à¸—à¸µ
LocalPlayer.Chatted:Connect(function(msg)
	if msg == "ðŸ˜" then
		-- à¹ƒà¸ªà¹ˆ Face
		wearAccessory(faceAccessoryId, Enum.AccessoryType.Face)
		-- à¸£à¸­ 3 à¸§à¸´à¸™à¸²à¸—à¸µà¹à¸¥à¹‰à¸§à¸–à¸­à¸”
		delay(3, function()
			removeAccessory(faceAccessoryId)
		end)
	end
end)
