-- Sound Logger v6.1 - All-Hunt Mode
-- โดย: Exploiter ตัวพ่อ

local Players = game:GetService("Players")
local player = Players.LocalPlayer
local StarterGui = game:GetService("StarterGui")
local TweenService = game:GetService("TweenService")

local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "SoundLoggerV6_1"
ScreenGui.ResetOnSpawn = false
ScreenGui.Parent = player:WaitForChild("PlayerGui")

-- === MainFrame (เท่ขึ้น + เงา) ===
local MainFrame = Instance.new("Frame")
MainFrame.Size = UDim2.new(0,720,0,520)
MainFrame.Position = UDim2.new(0.5,-360,0.5,-260)
MainFrame.BackgroundColor3 = Color3.fromRGB(20,20,30)
MainFrame.BorderSizePixel = 0
MainFrame.Active = true
MainFrame.Draggable = true
MainFrame.ZIndex = 10
MainFrame.Parent = ScreenGui

local Corner = Instance.new("UICorner")
Corner.CornerRadius = UDim.new(0,12)
Corner.Parent = MainFrame

local Shadow = Instance.new("ImageLabel")
Shadow.Size = UDim2.new(1,30,1,30)
Shadow.Position = UDim2.new(0,-15,0,-15)
Shadow.BackgroundTransparency = 1
Shadow.Image = "rbxassetid://6014261993"
Shadow.ImageColor3 = Color3.fromRGB(0,0,0)
Shadow.ImageTransparency = 0.6
Shadow.ZIndex = 9
Shadow.Parent = MainFrame

-- === Title Bar (มีกราเดียนท์) ===
local Title = Instance.new("Frame")
Title.Size = UDim2.new(1,0,0,45)
Title.BackgroundColor3 = Color3.fromRGB(40,40,60)
Title.ZIndex = 11
Title.Parent = MainFrame

local TitleCorner = Instance.new("UICorner")
TitleCorner.CornerRadius = UDim.new(0,12)
TitleCorner.Parent = Title

local Gradient = Instance.new("UIGradient")
Gradient.Color = ColorSequence.new{
	ColorSequenceKeypoint.new(0, Color3.fromRGB(70,70,120)),
	ColorSequenceKeypoint.new(1, Color3.fromRGB(40,40,80))
}
Gradient.Rotation = 90
Gradient.Parent = Title

local TitleLabel = Instance.new("TextLabel")
TitleLabel.Size = UDim2.new(1,-140,1,0)
TitleLabel.Position = UDim2.new(0,15,0,0)
TitleLabel.BackgroundTransparency = 1
TitleLabel.Text = "Sound Logger v6.1"
TitleLabel.Font = Enum.Font.GothamBlack
TitleLabel.TextColor3 = Color3.fromRGB(100,200,255)
TitleLabel.TextSize = 20
TitleLabel.TextXAlignment = Enum.TextXAlignment.Left
TitleLabel.ZIndex = 12
TitleLabel.Parent = Title

-- ปุ่มซ่อน
local ToggleButton = Instance.new("TextButton")
ToggleButton.Size = UDim2.new(0,110,0,32)
ToggleButton.Position = UDim2.new(1,-125,0,6.5)
ToggleButton.BackgroundColor3 = Color3.fromRGB(60,60,90)
ToggleButton.Text = "ซ่อน"
ToggleButton.TextColor3 = Color3.fromRGB(255,255,255)
ToggleButton.Font = Enum.Font.GothamBold
ToggleButton.TextSize = 13
ToggleButton.ZIndex = 13
ToggleButton.Parent = Title

local ToggleCorner = Instance.new("UICorner")
ToggleCorner.CornerRadius = UDim.new(0,8)
ToggleCorner.Parent = ToggleButton

-- === Scroll เสียง ===
local Scroll = Instance.new("ScrollingFrame")
Scroll.Size = UDim2.new(0.73,0,1,-50)
Scroll.Position = UDim2.new(0,10,0,50)
Scroll.BackgroundColor3 = Color3.fromRGB(15,15,25)
Scroll.BorderSizePixel = 0
Scroll.CanvasSize = UDim2.new(0,0,0,0)
Scroll.ScrollBarThickness = 5
Scroll.ZIndex = 11
Scroll.Parent = MainFrame

local ScrollCorner = Instance.new("UICorner")
ScrollCorner.CornerRadius = UDim.new(0,8)
ScrollCorner.Parent = Scroll

local UIListLayout = Instance.new("UIListLayout")
UIListLayout.Padding = UDim.new(0,6)
UIListLayout.Parent = Scroll

-- === Right Panel ===
local RightBar = Instance.new("Frame")
RightBar.Size = UDim2.new(0.26,0,1,-50)
RightBar.Position = UDim2.new(0.74,0,0,50)
RightBar.BackgroundColor3 = Color3.fromRGB(30,30,45)
RightBar.ZIndex = 11
RightBar.Parent = MainFrame

local RightCorner = Instance.new("UICorner")
RightCorner.CornerRadius = UDim.new(0,8)
RightCorner.Parent = RightBar

local RightLayout = Instance.new("UIListLayout")
RightLayout.Padding = UDim.new(0,6)
RightLayout.Parent = RightBar

-- === ปุ่ม "ล่าเสียงทุกคน" (ใหม่!) ===
local HuntAllButton = Instance.new("TextButton")
HuntAllButton.Size = UDim2.new(1,-10,0,40)
HuntAllButton.BackgroundColor3 = Color3.fromRGB(100,180,100)
HuntAllButton.Text = "ล่าเสียงทุกคน"
HuntAllButton.TextColor3 = Color3.fromRGB(255,255,255)
HuntAllButton.Font = Enum.Font.GothamBold
HuntAllButton.TextSize = 14
HuntAllButton.ZIndex = 12
HuntAllButton.Parent = RightBar

local HuntAllCorner = Instance.new("UICorner")
HuntAllCorner.CornerRadius = UDim.new(0,8)
HuntAllCorner.Parent = HuntAllButton

local HuntAllGradient = Instance.new("UIGradient")
HuntAllGradient.Color = ColorSequence.new{
	ColorSequenceKeypoint.new(0, Color3.fromRGB(120,200,120)),
	ColorSequenceKeypoint.new(1, Color3.fromRGB(80,160,80))
}
HuntAllGradient.Parent = HuntAllButton

-- === แถบ "จะเอาเสียงใคร" ===
local HuntTitle = Instance.new("TextLabel")
HuntTitle.Size = UDim2.new(1,-10,0,35)
HuntTitle.BackgroundColor3 = Color3.fromRGB(50,70,100)
HuntTitle.Text = "จะเอาเสียงใคร"
HuntTitle.TextColor3 = Color3.fromRGB(255,255,120)
HuntTitle.Font = Enum.Font.GothamBold
HuntTitle.TextSize = 15
HuntTitle.ZIndex = 12
HuntTitle.Parent = RightBar

local HuntTitleCorner = Instance.new("UICorner")
HuntTitleCorner.CornerRadius = UDim.new(0,6)
HuntTitleCorner.Parent = HuntTitle

-- === ช่องค้นหา ===
local SearchBox = Instance.new("TextBox")
SearchBox.Size = UDim2.new(1,-10,0,35)
SearchBox.BackgroundColor3 = Color3.fromRGB(40,40,60)
SearchBox.PlaceholderText = "พิมพ์ชื่อ..."
SearchBox.Text = ""
SearchBox.TextColor3 = Color3.fromRGB(255,255,255)
SearchBox.Font = Enum.Font.Gotham
SearchBox.TextSize = 14
SearchBox.ZIndex = 12
SearchBox.Parent = RightBar

local SearchCorner = Instance.new("UICorner")
SearchCorner.CornerRadius = UDim.new(0,6)
SearchCorner.Parent = SearchBox

-- === Scroll ผู้เล่น ===
local PlayerScroll = Instance.new("ScrollingFrame")
PlayerScroll.Size = UDim2.new(1,-10,1,-180)
PlayerScroll.Position = UDim2.new(0,5,0,140)
PlayerScroll.BackgroundTransparency = 1
PlayerScroll.ScrollBarThickness = 4
PlayerScroll.CanvasSize = UDim2.new(0,0,0,0)
PlayerScroll.ZIndex = 12
PlayerScroll.Parent = RightBar

local PlayerLayout = Instance.new("UIListLayout")
PlayerLayout.Padding = UDim.new(0,4)
PlayerLayout.Parent = PlayerScroll

-- === ปุ่มดึงเสียงเกม ===
local GameSoundToggle = Instance.new("TextButton")
GameSoundToggle.Size = UDim2.new(1,-10,0,35)
GameSoundToggle.BackgroundColor3 = Color3.fromRGB(70,120,70)
GameSoundToggle.Text = "ดึงเสียงเกม: เปิด"
GameSoundToggle.TextColor3 = Color3.fromRGB(255,255,255)
GameSoundToggle.Font = Enum.Font.GothamBold
GameSoundToggle.TextSize = 13
GameSoundToggle.ZIndex = 12
GameSoundToggle.Parent = RightBar

local GameCorner = Instance.new("UICorner")
GameCorner.CornerRadius = UDim.new(0,6)
GameCorner.Parent = GameSoundToggle

-- === ปุ่มเคลียร์ ===
local ClearButton = Instance.new("TextButton")
ClearButton.Size = UDim2.new(1,-10,0,35)
ClearButton.BackgroundColor3 = Color3.fromRGB(180,50,50)
ClearButton.Text = "เคลียร์ทั้งหมด"
ClearButton.TextColor3 = Color3.fromRGB(255,255,255)
ClearButton.Font = Enum.Font.GothamBold
ClearButton.TextSize = 13
ClearButton.ZIndex = 12
ClearButton.Parent = RightBar

local ClearCorner = Instance.new("UICorner")
ClearCorner.CornerRadius = UDim.new(0,6)
ClearCorner.Parent = ClearButton

-- === ปุ่มลอย ===
local FloatButton = Instance.new("TextButton")
FloatButton.Size = UDim2.new(0,130,0,45)
FloatButton.Position = UDim2.new(0.5,-65,0,15)
FloatButton.BackgroundColor3 = Color3.fromRGB(60,60,90)
FloatButton.Text = "เปิด GUI"
FloatButton.TextColor3 = Color3.fromRGB(255,255,255)
FloatButton.Font = Enum.Font.GothamBold
FloatButton.TextSize = 14
FloatButton.Visible = false
FloatButton.ZIndex = 20
FloatButton.Parent = ScreenGui
FloatButton.Active = true
FloatButton.Draggable = true

local FloatCorner = Instance.new("UICorner")
FloatCorner.CornerRadius = UDim.new(0,10)
FloatCorner.Parent = FloatButton

-- === ตัวแปร ===
local CaptureGameSounds = true
local LoggedSounds = {}
local TargetPlayers = {}
local PlayerRows = {}
local HuntAllActive = false

-- === ฟังก์ชันสร้างแถวผู้เล่น ===
local function CreatePlayerRow(p)
	if PlayerRows[p] or p == player then return end

	local Row = Instance.new("Frame")
	Row.Size = UDim2.new(1,0,0,48)
	Row.BackgroundColor3 = Color3.fromRGB(45,45,65)
	Row.ZIndex = 13
	Row.Parent = PlayerScroll

	local RowCorner = Instance.new("UICorner")
	RowCorner.CornerRadius = UDim.new(0,6)
	RowCorner.Parent = Row

	local Avatar = Instance.new("ImageLabel")
	Avatar.Size = UDim2.new(0,38,0,38)
	Avatar.Position = UDim2.new(0,5,0.5,-19)
	Avatar.BackgroundTransparency = 1
	Avatar.Image = GetAvatarImage(p.UserId)
	Avatar.ZIndex = 14
	Avatar.Parent = Row

	local NameLabel = Instance.new("TextLabel")
	NameLabel.Size = UDim2.new(0.5,0,1,0)
	NameLabel.Position = UDim2.new(0.2,0,0,0)
	NameLabel.BackgroundTransparency = 1
	NameLabel.Text = p.DisplayName
	NameLabel.TextColor3 = Color3.fromRGB(220,220,255)
	NameLabel.Font = Enum.Font.GothamSemibold
	NameLabel.TextSize = 13
	NameLabel.TextXAlignment = Enum.TextXAlignment.Left
	NameLabel.ZIndex = 14
	NameLabel.Parent = Row

	local HuntBtn = Instance.new("TextButton")
	HuntBtn.Size = UDim2.new(0.28,0,0.65,0)
	HuntBtn.Position = UDim2.new(0.7,0,0.175,0)
	HuntBtn.BackgroundColor3 = Color3.fromRGB(70,120,70)
	HuntBtn.Text = "ล่า"
	HuntBtn.TextColor3 = Color3.fromRGB(255,255,255)
	HuntBtn.Font = Enum.Font.GothamBold
	HuntBtn.TextSize = 11
	HuntBtn.ZIndex = 14
	HuntBtn.Parent = Row

	local BtnCorner = Instance.new("UICorner")
	BtnCorner.CornerRadius = UDim.new(0,5)
	BtnCorner.Parent = HuntBtn

	local isHunting = false
	HuntBtn.MouseButton1Click:Connect(function()
		isHunting = not isHunting
		TargetPlayers[p] = isHunting or nil
		HuntBtn.Text = isHunting and "หยุด" or "ล่า"
		HuntBtn.BackgroundColor3 = isHunting and Color3.fromRGB(180,70,70) or Color3.fromRGB(70,120,70)
	end)

	PlayerRows[p] = {Row = Row, HuntBtn = HuntBtn}
end

-- === ปุ่มล่าเสียงทุกคน ===
HuntAllButton.MouseButton1Click:Connect(function()
	HuntAllActive = not HuntAllActive
	HuntAllButton.Text = HuntAllActive and "หยุดล่าทั้งหมด" or "ล่าเสียงทุกคน"
	HuntAllButton.BackgroundColor3 = HuntAllActive and Color3.fromRGB(180,70,70) or Color3.fromRGB(100,180,100)

	for p, data in pairs(PlayerRows) do
		local shouldHunt = HuntAllActive
		TargetPlayers[p] = shouldHunt or nil
		data.HuntBtn.Text = shouldHunt and "หยุด" or "ล่า"
		data.HuntBtn.BackgroundColor3 = shouldHunt and Color3.fromRGB(180,70,70) or Color3.fromRGB(70,120,70)
	end
end)

-- === ค้นหา ===
SearchBox:GetPropertyChangedSignal("Text"):Connect(function()
	local query = SearchBox.Text:lower()
	for p, data in pairs(PlayerRows) do
		local matches = p.DisplayName:lower():find(query) or p.Name:lower():find(query)
		data.Row.Visible = (query == "" or matches)
	end
end)

-- === ดึง Avatar (ปลอดภัย) ===
function GetAvatarImage(userId)
	local success, content = pcall(function()
		return Players:GetUserThumbnailAsync(userId, Enum.ThumbnailType.HeadShot, Enum.ThumbnailSize.Size48x48)
	end)
	return success and content or ""
end

-- === เพิ่มผู้เล่น ===
Players.PlayerAdded:Connect(CreatePlayerRow)
Players.PlayerRemoving:Connect(function(p)
	if PlayerRows[p] then
		PlayerRows[p].Row:Destroy()
		PlayerRows[p] = nil
		TargetPlayers[p] = nil
	end
end)
for _, p in pairs(Players:GetPlayers()) do
	if p ~= player then CreatePlayerRow(p) end
end

-- === หาเจ้าของเสียง ===
local function GetSoundOwner(sound)
	for _, p in pairs(Players:GetPlayers()) do
		if p.Character and sound:IsDescendantOf(p.Character) then
			return p
		end
	end
	return nil
end

-- === เพิ่มแถวเสียง ===
local function AddSoundRow(sound, owner)
	if not sound:IsA("Sound") or LoggedSounds[sound.SoundId] then return end
	if not CaptureGameSounds and not owner then return end
	if owner and not TargetPlayers[owner] and not HuntAllActive then return end

	LoggedSounds[sound.SoundId] = true

	local Row = Instance.new("Frame")
	Row.Size = UDim2.new(1,-10,0,62)
	Row.BackgroundColor3 = Color3.fromRGB(35,35,55)
	Row.ZIndex = 12
	Row.Parent = Scroll

	local RowCorner = Instance.new("UICorner")
	RowCorner.CornerRadius = UDim.new(0,8)
	RowCorner.Parent = Row

	local Avatar = Instance.new("ImageLabel")
	Avatar.Size = UDim2.new(0,50,0,50)
	Avatar.Position = UDim2.new(0,6,0.5,-25)
	Avatar.BackgroundTransparency = 1
	Avatar.Image = owner and GetAvatarImage(owner.UserId) or "rbxassetid://0"
	Avatar.ZIndex = 13
	Avatar.Parent = Row

	local NameLabel = Instance.new("TextLabel")
	NameLabel.Size = UDim2.new(0.48,0,1,0)
	NameLabel.Position = UDim2.new(0.14,0,0,0)
	NameLabel.BackgroundTransparency = 1
	NameLabel.Text = owner and (owner.DisplayName.." "..sound.Name) or ("ระบบ: "..sound.Name)
	NameLabel.TextColor3 = Color3.fromRGB(200,230,255)
	NameLabel.Font = Enum.Font.GothamSemibold
	NameLabel.TextSize = 13
	NameLabel.TextXAlignment = Enum.TextXAlignment.Left
	NameLabel.ZIndex = 13
	NameLabel.Parent = Row

	local PlayBtn = Instance.new("TextButton")
	PlayBtn.Size = UDim2.new(0.14,0,0.75,0)
	PlayBtn.Position = UDim2.new(0.63,0,0.125,0)
	PlayBtn.BackgroundColor3 = Color3.fromRGB(70,120,180)
	PlayBtn.Text = "Play"
	PlayBtn.TextColor3 = Color3.fromRGB(255,255,255)
	PlayBtn.Font = Enum.Font.GothamBold
	PlayBtn.TextSize = 12
	PlayBtn.ZIndex = 13
	PlayBtn.Parent = Row

	local PlayCorner = Instance.new("UICorner")
	PlayCorner.CornerRadius = UDim.new(0,6)
	PlayCorner.Parent = PlayBtn

	local CopyBtn = Instance.new("TextButton")
	CopyBtn.Size = UDim2.new(0.14,0,0.75,0)
	CopyBtn.Position = UDim2.new(0.79,0,0.125,0)
	CopyBtn.BackgroundColor3 = Color3.fromRGB(90,90,120)
	CopyBtn.Text = "Copy"
	CopyBtn.TextColor3 = Color3.fromRGB(255,255,255)
	CopyBtn.Font = Enum.Font.GothamBold
	CopyBtn.TextSize = 12
	CopyBtn.ZIndex = 13
	CopyBtn.Parent = Row

	local CopyCorner = Instance.new("UICorner")
	CopyCorner.CornerRadius = UDim.new(0,6)
	CopyCorner.Parent = CopyBtn

	local LocalSound = Instance.new("Sound")
	LocalSound.SoundId = sound.SoundId
	LocalSound.Volume = 1
	LocalSound.Parent = workspace

	local isPlaying = false
	PlayBtn.MouseButton1Click:Connect(function()
		if not isPlaying then
			LocalSound:Play()
			PlayBtn.Text = "Pause"
			isPlaying = true
		else
			LocalSound:Stop()
			PlayBtn.Text = "Play"
			isPlaying = false
		end
	end)

	CopyBtn.MouseButton1Click:Connect(function()
		setclipboard(sound.SoundId)
		StarterGui:SetCore("SendNotification", {Title="คัดลอก!", Text=sound.SoundId, Duration=2})
	end)
end

-- === Queue เสียง ===
local soundQueue = {}
local processing = false
local function ProcessQueue()
	if processing then return end
	processing = true
	while #soundQueue > 0 do
		local s = table.remove(soundQueue,1)
		local owner = GetSoundOwner(s)
		if not LoggedSounds[s.SoundId] then
			if CaptureGameSounds or (owner and (TargetPlayers[owner] or HuntAllActive)) then
				AddSoundRow(s, owner)
			end
		end
		task.wait(0.03)
	end
	processing = false
end

workspace.DescendantAdded:Connect(function(obj)
	if obj:IsA("Sound") then
		table.insert(soundQueue, obj)
		ProcessQueue()
	end
end)

for _, obj in pairs(workspace:GetDescendants()) do
	if obj:IsA("Sound") then table.insert(soundQueue, obj) end
end
ProcessQueue()

-- === ปุ่มต่าง ๆ ===
GameSoundToggle.MouseButton1Click:Connect(function()
	CaptureGameSounds = not CaptureGameSounds
	GameSoundToggle.Text = CaptureGameSounds and "ดึงเสียงเกม: เปิด" or "ดึงเสียงเกม: ปิด"
	GameSoundToggle.BackgroundColor3 = CaptureGameSounds and Color3.fromRGB(70,120,70) or Color3.fromRGB(120,70,70)
end)

ClearButton.MouseButton1Click:Connect(function()
	for _, child in pairs(Scroll:GetChildren()) do
		if child:IsA("Frame") then child:Destroy() end
	end
	LoggedSounds = {}
end)

local visible = true
ToggleButton.MouseButton1Click:Connect(function()
	visible = not visible
	MainFrame.Visible = visible
	ToggleButton.Text = visible and "ซ่อน" or "เปิด"
	FloatButton.Visible = not visible
end)

FloatButton.MouseButton1Click:Connect(function()
	MainFrame.Visible = true
	FloatButton.Visible = false
	ToggleButton.Text = "ซ่อน"
	visible = true
end)

-- === ป้องกัน GUI หาย ===
player.CharacterAdded:Connect(function()
	task.wait(1)
	if not player.PlayerGui:FindFirstChild("SoundLoggerV6_1") then
		ScreenGui.Parent = player:WaitForChild("PlayerGui")
	end
end)

-- === อัปเดต Canvas ===
UIListLayout:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
	Scroll.CanvasSize = UDim2.new(0,0,0,UIListLayout.AbsoluteContentSize.Y + 10)
end)

PlayerLayout:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
	PlayerScroll.CanvasSize = UDim2.new(0,0,0,PlayerLayout.AbsoluteContentSize.Y + 10)
end)
